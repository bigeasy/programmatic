function Source(e){this.$source=[],this.$blocks={}}function indent(e,t,n){return e=e.split(/\n/).map(function(e){return/\S/.test(e)?t+e:e}),n&&e[e.length-1]==""&&e.pop(),e.join("\n")}function createSource(e){var t=function(e){return t.push(e)};t.$source=[],t.$blocks={};for(var n in Source)t[n]=Source[n];return t.push(e),t}var __slice=[].slice,Source={};Source.push=function(e){if(typeof e!="function"){this.$source.push(function(){return String(e)});return}var t=String(e),n=/^function \(([^)]*)\) {/.exec(t)[1].trim();n=n?n.split(/, /):[],/\n/.test(t)?(t=t.split(/\n/).slice(1,-1),t.push("")):t=[/^function \([^)]*\) {(.*)}$/.exec(t)[1].trim()];var r=Number.MAX_VALUE;t.forEach(function(e){/\S/.test(e)&&(r=Math.min(r,e.length-e.replace(/^\s+/,"").length))}),t=t.map(function(e){return/\S/.test(e)?e.substring(r):""});var i=t.join("\n");t=[""];while(i){var s=/^((?:[^,\\'"\/$]|\\.|(["'])(?:[^\\\1]|\\.)*\2)*)([^\u0000]*)/.exec(i),o=s[3];t[0]+=s[1];if(o.length<2)t[0]+=o,i="";else switch(o[2]){case"$":t[0]+=o[0],i=o.substring(2);break;case"(":break;default:(s=/^\$([_\w][_$\w\d]*)([^\u0000]*)/.exec(o))?(i=s[2],this[s[1]]=function(e){return function(t){var n=createSource(t);this.$blocks[e]=n}}(s[1]),t.unshift("",function(e){return function(){return String(this.$blocks[e])}}(s[1]))):(t[0]+=o[0],i=o.substring(1))}}t=t.reverse().map(function(e,t){return t%2?e:function(){return e}}),this.$source.push.apply(this.$source,t)},Source.toString=function(){var e=[],t,n;return this.$source.forEach(function(r,i){n=r.call(this);if(i%2){var s=/\n([\t ]+)$/.exec(t);if(s&&/\n/.test(n)){var o=s[1];n=indent(n,o,!0),n=n.substring(o.length)}}e.push(n),t=n},this),e.join("")},Source.compile=function(){var e=__slice.call(arguments);return Function.apply(Function,e.concat(indent(this.toString(),"    ",!0)))},module.exports=createSource;